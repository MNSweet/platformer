<!doctype html>
<html>
<head>
		<title>My fancy game</title>
</head>
<body style="padding:10px 0 0">

<canvas id="canvas" style="border:1px solid #000; display:block; margin:auto;"></canvas>
<script type="text/javascript">var debug = true;</script>
<script type="text/javascript" src="js/entities.js"></script>
<script type="text/javascript" src="js/structure.js"></script>
<script>
(function() {
	var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
	window.requestAnimationFrame = requestAnimationFrame;
})();
var canvas = document.getElementById("canvas"),
	ctx = canvas.getContext("2d"),
	width = 1000,
	height = 400,
	player = {},
	keys = [],
	gravity = 0.3,
	friction = 0.8,
	structures = [];

Maps = function(id,imgSrc,varWidth,varHeight){
	var	self = {
		id:id,
		image: new Image(),
		width:varWidth,
		height:varHeight
	};
	
	self.image.src = imgSrc;
	self.image.height = self.height;
	self.image.width = self.width;

	self.draw = function() {
		ctx.drawImage(
			self.image,
			0,
			0,
			width,
			height,
			0,
			0,
			width,
			height
		)

	}

	self.drawPattern = function() {
		var ptrn = ctx.createPattern(self.image, 'repeat'); // Create a pattern with this image, and set it to "repeat".
	    ctx.fillStyle = ptrn;
	    ctx.fillRect(0, 0, canvas.width, canvas.height); // context.fillRect(x, y, width, height);
	}

	return self;
}
imgLib.ground		= new Image();
imgLib.ground.src	= "img/ground.png";
imgLib.platform		= new Image();
imgLib.platform.src	= "img/platform.png";
var currentMap = Maps('feild','img/map.jpg',800,500);


canvas.width = width;
canvas.height = height;

document.body.addEventListener("keydown", function(e) {
	keys[e.keyCode] = true;
});
 
document.body.addEventListener("keyup", function(e) {
	keys[e.keyCode] = false;
});

function update(){
	//reset screen
	ctx.clearRect(0,0,width,height);
	//currentMap.drawPattern();

	player.grounded = false;
	//render obstacles

	for (var i = 0; i < structures.length; i++) {
		structures[i].update();
	};

	player.update();
	// run through the loop again
	requestAnimationFrame(update);
};


window.addEventListener("load", function(){
	player = Player();
	structures.push(Ground(width/6,height-10,width/1.5,15));
	//structures.push(Ground(100,height-100,width/4,15));
	structures.push(Ground(200,height-200,width/4,15));
	structures.push(Ground(300,height-300,width/4,15));
	structures.push(Platform(100,height-100,width/4,15,10,0,.4));
	update();
});
	
</script>
</body>
</html>