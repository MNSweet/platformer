<!doctype html>
<html>
<head>
		<title>Platformer an Infinite Runner</title>
</head>
<body style="padding:10px 0 0; background-color:#000;">

<canvas id="canvas" style="border:1px solid #000; display:block; margin:auto; background-color:#77BBFF;"></canvas>
<script type="text/javascript">var debug = true;</script>
<script type="text/javascript" src="js/assets.lib.js"></script>
<script type="text/javascript" src="js/display.js"></script>
<script type="text/javascript" src="js/entities.js"></script>
<script type="text/javascript" src="js/structure.js"></script>
<script>
(function() {
	var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
	window.requestAnimationFrame = requestAnimationFrame;
})();


var canvas = document.getElementById("canvas"),
	ctx = canvas.getContext("2d"),
	player = {},
	keys = [],
	structures = [],
	entities = [];

function gameInit(){
	canvas.width = 1000;
	canvas.height = 400;
	canvas.gravity = 0.3;
	canvas.friction = 0.8;
	canvas.endCap = EndCap();

	document.body.addEventListener("keydown", function(e) {
		keys[e.keyCode] = true;
	});
	 
	document.body.addEventListener("keyup", function(e) {
		keys[e.keyCode] = false;
	});

	player = Player();
	tutorial();
};

function tutorial(){	
	structures.push(Ground(0,canvas.height-10,canvas.width,15));
	entities.push(Sign(630,300,150,10,70,0,1,'Welcome to Platformer'));
};

function update(){
	//reset screen
	ctx.clearRect(0,0,canvas.width,canvas.height);
	bg.draw('main');

	player.grounded = false;

	//render obstacles
	for (var i = 0; i < entities.length; i++) {
		entities[i].colliding = player.testCollision.entity(entities[i]);
		entities[i].update();
	};
	for (var i = 0; i < structures.length; i++) {
		player.testCollision.structure(structures[i]);
		structures[i].update();
	};
	player.testCollision.structure(canvas.endCap);
	canvas.endCap.update();
	player.update();

	// run through the loop again
	requestAnimationFrame(update);
};


window.addEventListener("load", function(){
	gameInit();
	update();
});
	
</script>
</body>
</html>